---
output:
  md_document:
    variant: markdown_github
---

### Risk Parity Portfolios (RPPs): A Comparative Study in South Africa  

#### Introduction  
Risk parity portfolios (RPPs) aim to equalize the risk contribution of each asset within a portfolio. This strategy contrasts with modern portfolio theory (MPT)-based methods, such as the mean-variance approach, which rely on assumptions about expected returns and variance. RPPs bypass the need for return forecasts, instead emphasizing risk estimates, particularly volatility and correlations.  

Unlike MPT, which focuses on either maximizing returns or minimizing variance, RPPs prioritize explicit risk allocation. This research investigates the performance of RPPs relative to South African index funds, posing the key question:  

**How can the risk parity approach be effectively implemented to construct a diversified portfolio of South African assets, and how does it compare to traditional asset allocation strategies in terms of risk-adjusted returns?**  

#### Focus on Risk-Adjusted Returns  
The study aims to evaluate risk-adjusted returns, a core objective of RPPs. To achieve this, an expanded set of performance metrics will be analyzed:  
- Sharpe ratio  
- Sterling ratio  
- Alpha and Beta  
- Sortino ratio  
- Maximum drawdown  
- Calmar ratio  
- Information ratio (vs. a relevant benchmark)  

#### Asset Selection  
For constructing a South African RPP, a diverse range of traded assets will be included:  
- Stocks listed on the Johannesburg Stock Exchange  
- South African government bond yields (2-year and 10-year maturities)  

#### Incorporating Economic Regimes  
To enhance analytical rigor, portfolio performance will be examined across South Africaâ€™s distinct economic regimes, such as:  
- Periods of high and low economic growth  
- Periods of high and low inflation  

This evaluation will illuminate the adaptability of risk parity strategies compared to traditional asset allocation methods under varying market conditions.  

#### Conclusion  
By integrating additional performance metrics and analyzing economic regimes, this study will deliver a thorough evaluation of the risk parity approach within the South African context. The findings aim to deepen understanding of RPP effectiveness in constructing diversified portfolios and their comparative performance against traditional strategies under diverse market scenarios.  

```{r}

rm(list = ls()) # Clean your environment:
gc() # garbage collection - It can be useful to call gc after a large object has been removed, as this may prompt R to return memory to the operating system.
library(tidyverse)
list.files('code/', full.names = T, recursive = T) %>% .[grepl('.R', .)] %>% as.list() %>% walk(~source(.))
```

```{r}
library(PerformanceAnalytics)
library(riskParityPortfolio)
library(fPortfolio)
library(dplyr)
library(tidyr)
library(xts)
library(lubridate)
library(kableExtra)
library(RiskPortfolios)
library(PortfolioAnalytics)
library(PerformanceAnalytics)
library(ROI)
library(ROI.plugin.quadprog)
library(zoo)
library(DEoptim)
library(doParallel)
library(foreach)
LCL_Stock_Returns <- read_rds("/Users/x/Downloads/Data_2024/LCL_Stock_Returns.rds")
BondYields_10Y_SA <- read_rds("/Users/x/Downloads/Data_2024/BondYields_10Y_SA.rds")
BondYields_2Y_SA <- read_rds("/Users/x/Downloads/Data_2024/BondYields_2Y_SA.rds")
SA_Growth <- read_csv2("/Users/x/Downloads/SA_Growth.csv", show_col_types = FALSE)
```

```{r}
LCL_filtered <- filter_stock_function(LCL_Stock_Returns)
```

```{r}
weights_mv <- rolling_min_vol_portfolio_weights(LCL_filtered, 252, 63)
returns.mv <- Return.portfolio(LCL_filtered, weights = weights_mv, verbose = TRUE)
weights_md <- most_diversified_weights(LCL_filtered, window_size = 252, rebalance_interval = 63) 
returns.md <- Return.portfolio(LCL_filtered, weights = weights_md, verbose = TRUE)
```

```{r}
Bond_return_10 <- Bond_return(BondYields_10Y_SA, "BondYield_10", 10)
Bond_return_2 <- Bond_return(BondYields_2Y_SA, "BondYield_2", 2)
```

```{r}
LCL_Bond <- merge.xts(Bond_return_10, Bond_return_2, LCL_filtered, join = "inner")
Sigma <- cov(LCL_Bond)
```

```{r}
portfolio.parity <- riskParityPortfolio(Sigma)
rWindows<-rollingWindows(LCL_Bond, period="12m",
                         by="3m")
parity.weights <- RollingRiskParity(rWindows$from@Data, rWindows$to@Data, LCL_Bond) %>% na.omit()
parity.returns <- Return.portfolio(LCL_Bond, weights=parity.weights,verbose=TRUE)
```

```{r}
Sigma_nb <- cov(LCL_filtered)
portfolio.parity.nb <- riskParityPortfolio(Sigma_nb)
rWindows.nb<-rollingWindows(LCL_filtered, period="12m",
                         by="3m")
parity.weights.nb <- RollingRiskParity(rWindows.nb$from@Data, rWindows.nb$to@Data, LCL_filtered) %>% na.omit()
parity.returns.nb <- Return.portfolio(LCL_filtered, weights=parity.weights.nb,verbose=TRUE)
p.returns.nb <- merge.xts(returns.mv$returns, parity.returns.nb$returns, parity.returns$returns, returns.md$returns, join = "inner")
names(p.returns.nb)<-c("MVP", "RPP w/o Bonds", "RPP", "MDP")
```

```{r}
PerformanceAnalytics::chart.CumReturns(p.returns.nb, colorset=rich6equal,
                          lwd=1, cex.legend = 0.5, event.labels = TRUE, main = "", legend.loc = "topleft")
```

```{r}
chart.RollingPerformance(p.returns.nb, width = 252, colorset=rich6equal,
                          lwd=1, cex.legend = 0.5, event.labels = TRUE, main = "", legend.loc = "top")
```

```{r}
bind_rows(
  as.data.frame(Return.cumulative(p.returns.nb)),
  as.data.frame(Return.annualized(p.returns.nb))
) %>% kbl(caption = "Cumulative and Annualized Returns", label = "returns") %>% 
    kable_styling()
```

```{r}
chart.Drawdown(p.returns.nb, colorset=rich6equal,
                          lwd=1, cex.legend = 0.5, event.labels = TRUE, main = "", legend.loc = "bottom")
```

```{r}
table.DrawdownsRatio(p.returns.nb, Rf = 0.08975) %>%
  kbl(caption = "Drawdowns ratio table", label = "drawdowns-ratio") %>%
  kable_styling()
```

```{r}
calculate_ratios(p.returns.nb, BondYields_10Y_SA) %>% 
    kbl(caption = "Downside and Opportunity-based Performance Metrics", label = "downside-metrics") %>%
    kable_styling()
```

```{r}
return_parity <- return_data(parity.returns)
return_mv <- return_data(returns.mv)
return_parity_nb <- return_data(parity.returns.nb)
return_md <- return_data(returns.md)

regime <- economic_regime(SA_Growth, 3, 0)

results_mv <- regime_returns(return_mv, regime)
results_RPP <- regime_returns(return_parity, regime)
results_RPP_nb <- regime_returns(return_parity_nb, regime)
results_md <- regime_returns(return_md, regime)

combine_regime_results(results_mv, results_RPP, results_RPP_nb, results_md) %>% 
    kbl(caption = "Performance at Different Economic States", label = "regime") %>% 
    kable_styling()
```




